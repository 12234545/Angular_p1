<!-- Bouton de chatbot flottant qui apparaît lorsque la fenêtre de chat est fermée -->
<div class="floating-chatbot-container" [ngClass]="{'open': isOpen, 'expanded': isExpanded}" (click)="onChatClick($event)">
  <!-- Bouton flottant -->
  <div class="chat-toggle" *ngIf="!isOpen" (click)="toggleChat($event)">
    <!-- Message d'aide au-dessus du bouton -->
    <div class="chat-help-message" *ngIf="showHelpMessage" (click)="$event.stopPropagation()">
      Je suis là si vous avez des questions
    </div>
    <div class="chat-icon">
      <img src="pictures/chat.png" alt="Chat Icon">
    </div>
  </div>

  <!-- Fenêtre de chat -->
  <div class="chat-window" *ngIf="isOpen" (click)="onChatClick($event)">
    <!-- En-tête du chatbot -->
    <div class="chat-header">
      <div class="header-left">
        <div class="header-avatar">
          <img src="pictures/chat.png" alt="Avatar">
        </div>
        <div class="header-title">Formito</div>
      </div>
      <div class="header-actions">
        <button class="action-button" (click)="toggleExpand($event)" aria-label="Agrandir/Réduire">
          <i class="pi" [ngClass]="isExpanded ? 'pi-arrow-down-left-and-arrow-up-right-to-center' : 'pi-arrow-up-right-and-arrow-down-left-from-center'"></i>
        </button>
        <button class="action-button" (click)="openFullChatbot($event)" aria-label="Ouvrir en plein écran">
          <i class="pi pi-external-link"></i>
        </button>
        <button class="action-button" (click)="toggleChat($event)" aria-label="Fermer">
          <i class="pi pi-times"></i>
        </button>
      </div>
    </div>

    <!-- Zone des messages -->
    <div class="chat-messages" #messagesContainer>
      <div *ngFor="let msg of messages"
           [ngClass]="{'user-message': msg.sender === 'user', 'bot-message': msg.sender === 'bot'}">
        <div class="message-content">
          <div *ngIf="msg.sender === 'bot'" class="avatar-container">
            <div class="bot-avatar">
              <i class="pi pi-comments"></i>
            </div>
          </div>
          <div class="message-text">
            {{ msg.text }}
          </div>
          <div *ngIf="msg.sender === 'user'" class="avatar-container">
            <div class="user-avatar">
              <i class="pi pi-user"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Indicateur de chargement -->
      <div *ngIf="loading" class="bot-message">
        <div class="message-content">
          <div class="avatar-container">
            <div class="bot-avatar">
              <i class="pi pi-comments"></i>
            </div>
          </div>
          <div class="typing-indicator">
            <span></span>
            <span></span>
            <span></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Zone de saisie -->
    <div class="chat-input">
      <div class="input-container">
        <input type="text"
               [(ngModel)]="newMessage"
               placeholder="Tapez votre message ici..."
               (keyup.enter)="sendMessage($event)"
               (click)="$event.stopPropagation()"
               class="message-input" />
        <button class="send-button" (click)="sendMessage($event)" [disabled]="loading || !newMessage.trim()">
          <i class="pi pi-send"></i>
        </button>
      </div>
    </div>
  </div>
</div>
